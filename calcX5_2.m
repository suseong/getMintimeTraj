function [pos,tsq] = calcX5_2(input,initState,finalState,tf)

% a0,af,am,tf,u,v0,vf

u = input(1);
am = input(2);

x0 = initState(1);
v0 = initState(2);
a0 = initState(3);

% xf = finalState(1);
vf = finalState(2);
af = finalState(3);

coeffs = [u,af.*2.0-am.*2.0-tf.*u.*2.0,(tf.^2.*u.^2-a0.*am-af.*am-u.*v0+u.*vf+a0.^2.*(1.0./2.0)+af.^2.*(1.0./2.0)+am.^2-af.*tf.*u.*2.0+am.*tf.*u)./u];

A = coeffs(1);
B = coeffs(2);
C = coeffs(3);

t1 = (am - a0) / u;

t3_1 = (-B + sqrt(B^2 -4*A*C)) / (2*A);
t2_1 = (af - am + 2*t3_1*u - tf*u) / u;

t3_2 = (-B - sqrt(B^2 -4*A*C)) / (2*A);
t2_2 = (af - am + 2*t3_2*u - tf*u) / u;

t4_1 = t3_1;
t4_2 = t3_2;

t2 = t2_1;
t3 = t3_1;
x5_1 = x0+(am.*(1.0./2.0)+u.*(t2-t3).*(1.0./2.0)).*(t3-tf).^2-1.0./u.^2.*(a0-am).^3.*(1.0./6.0)-(t2-t3).*(v0+((a0-am).^2.*(1.0./2.0))./u+am.*(t2+(a0-am)./u)-(a0.*(a0-am))./u)-(t3-tf).*(v0+((a0-am).^2.*(1.0./2.0))./u+am.*(t2+(a0-am)./u)-am.*(t2-t3)-u.*(t2-t3).^2.*(1.0./2.0)-(a0.*(a0-am))./u)+am.*(t2+(a0-am)./u).^2.*(1.0./2.0)+am.*(t2-t3).^2.*(1.0./2.0)+u.*(t2-t3).^3.*(1.0./6.0)-u.*(t3-tf).^3.*(1.0./6.0)+(t2+(a0-am)./u).*(v0+((a0-am).^2.*(1.0./2.0))./u-(a0.*(a0-am))./u)-(v0.*(a0-am))./u+a0.*1.0./u.^2.*(a0-am).^2.*(1.0./2.0);

t2 = t2_2;
t3 = t3_2;
x5_2 = x0+(am.*(1.0./2.0)+u.*(t2-t3).*(1.0./2.0)).*(t3-tf).^2-1.0./u.^2.*(a0-am).^3.*(1.0./6.0)-(t2-t3).*(v0+((a0-am).^2.*(1.0./2.0))./u+am.*(t2+(a0-am)./u)-(a0.*(a0-am))./u)-(t3-tf).*(v0+((a0-am).^2.*(1.0./2.0))./u+am.*(t2+(a0-am)./u)-am.*(t2-t3)-u.*(t2-t3).^2.*(1.0./2.0)-(a0.*(a0-am))./u)+am.*(t2+(a0-am)./u).^2.*(1.0./2.0)+am.*(t2-t3).^2.*(1.0./2.0)+u.*(t2-t3).^3.*(1.0./6.0)-u.*(t3-tf).^3.*(1.0./6.0)+(t2+(a0-am)./u).*(v0+((a0-am).^2.*(1.0./2.0))./u-(a0.*(a0-am))./u)-(v0.*(a0-am))./u+a0.*1.0./u.^2.*(a0-am).^2.*(1.0./2.0);

tsq1 = real([t1 t2_1 t3_1 t4_1 tf]);
tsq2 = real([t1 t2_2 t3_2 t4_2 tf]);

pos = real([x5_1 x5_2]);
tsq = [tsq1;tsq2];

end




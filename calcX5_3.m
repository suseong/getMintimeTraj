function [pos,tsq] = calcX5_3(input,initState,finalState,tf)

% a0,af,am,tf,u,v0,vf

u = input(1);
am = input(2);

x0 = initState(1);
v0 = initState(2);
a0 = initState(3);

xf = finalState(1);
vf = finalState(2);
af = finalState(3);

coeffs = [u.*(-1.0./4.0),a0.*(-1.0./2.0)-am.*(1.0./2.0),(a0.*am.*(1.0./2.0)-af.*am-u.*v0+u.*vf+a0.^2.*(1.0./4.0)-af.^2.*(1.0./2.0)-am.^2.*(1.0./4.0)+am.*tf.*u)./u];

A = coeffs(1);
B = coeffs(2);
C = coeffs(3);

t4 = tf - (af+am)/u;
t3_1 = (-B + sqrt(B^2 -4*A*C)) / (2*A);
t1_1 = -(a0 + am - t3_1*u)/(2*u);
t2_1 = t1_1;

t3_2 = (-B - sqrt(B^2 -4*A*C)) / (2*A);
t1_2 = -(a0 + am - t3_2*u)/(2*u);
t2_2 = t1_2;

t1 = t1_1;
t3 = t3_1;
x5_1 = x0+t1.*v0+a0.*t1.^2.*(1.0./2.0)+(a0.*(1.0./2.0)+t1.*u.*(1.0./2.0)+u.*(t1-t3).*(1.0./2.0)).*(t3-tf+(af+am)./u).^2+t1.^3.*u.*(1.0./6.0)+1.0./u.^2.*(af+am).^3.*(1.0./6.0)-(t1-t3).*(v0+a0.*t1+t1.^2.*u.*(1.0./2.0))+(a0.*(1.0./2.0)+t1.*u.*(1.0./2.0)).*(t1-t3).^2+u.*(t1-t3).^3.*(1.0./6.0)-(t3-tf+(af+am)./u).*(v0-(a0+t1.*u).*(t1-t3)+a0.*t1+t1.^2.*u.*(1.0./2.0)-u.*(t1-t3).^2.*(1.0./2.0))+1.0./u.^2.*(af+am).^2.*(a0.*(1.0./2.0)+t1.*u.*(1.0./2.0)+u.*(t1-t3).*(1.0./2.0))+((af+am).*(v0-(a0+t1.*u).*(t1-t3)+a0.*t1+t1.^2.*u.*(1.0./2.0)-u.*(t1-t3).^2.*(1.0./2.0)-(a0+t1.*u+u.*(t1-t3)).*(t3-tf+(af+am)./u)))./u;

t1 = t1_2;
t3 = t3_2;
x5_2 = x0+t1.*v0+a0.*t1.^2.*(1.0./2.0)+(a0.*(1.0./2.0)+t1.*u.*(1.0./2.0)+u.*(t1-t3).*(1.0./2.0)).*(t3-tf+(af+am)./u).^2+t1.^3.*u.*(1.0./6.0)+1.0./u.^2.*(af+am).^3.*(1.0./6.0)-(t1-t3).*(v0+a0.*t1+t1.^2.*u.*(1.0./2.0))+(a0.*(1.0./2.0)+t1.*u.*(1.0./2.0)).*(t1-t3).^2+u.*(t1-t3).^3.*(1.0./6.0)-(t3-tf+(af+am)./u).*(v0-(a0+t1.*u).*(t1-t3)+a0.*t1+t1.^2.*u.*(1.0./2.0)-u.*(t1-t3).^2.*(1.0./2.0))+1.0./u.^2.*(af+am).^2.*(a0.*(1.0./2.0)+t1.*u.*(1.0./2.0)+u.*(t1-t3).*(1.0./2.0))+((af+am).*(v0-(a0+t1.*u).*(t1-t3)+a0.*t1+t1.^2.*u.*(1.0./2.0)-u.*(t1-t3).^2.*(1.0./2.0)-(a0+t1.*u+u.*(t1-t3)).*(t3-tf+(af+am)./u)))./u;

tsq1 = real([t1_1 t2_1 t3_1 t4 tf]);
tsq2 = real([t1_2 t2_2 t3_2 t4 tf]);

pos = real([x5_1 x5_2]);
tsq = [tsq1;tsq2];

end